## Streamlit 지하철 혼잡도 대시보드 구현 계획

### 1) 목적
- 서울교통공사 혼잡도 CSV(2025-09-30) 기반으로 **노선/역/시간대별 혼잡 패턴을 탐색**하고, 사용자가 쉽게 비교·다운로드할 수 있는 대시보드 제공

### 2) 데이터(현재 CSV) 구조 요약
- **기본 컬럼**: 운영기관, 호선, 역번호, 역명, 구분(상/하 또는 내/외 성격)
- **시간대 컬럼**: 5시30분 ~ 00시30분, 30분 간격(총 43개 시간대)
- **값**: 혼잡도(%)로 보이는 수치(0~150% 이상 가능)

### 3) 전처리/표준화(공통)
- **인코딩 처리**
  - 한글 깨짐 방지를 위해 `cp949`(또는 `euc-kr`) 우선 시도, 실패 시 `utf-8-sig` 등 fallback
- **정리**
  - 컬럼명/문자열: 좌우 공백 제거, 결측 처리
  - 혼잡도: 숫자 변환(`to_numeric`, errors='coerce') 후 NaN 처리
- **long 포맷 변환(권장)**
  - wide(시간대가 열) → long(시간대가 행)
  - 최종 스키마 예:
    - `operator`(운영기관), `line`(호선), `station_id`(역번호), `station`(역명), `direction`(구분)
    - `time_slot`(예: '07:30'), `congestion`(float)
- **캐시**
  - `st.cache_data`로 로딩/전처리 결과 캐시

### 4) 권장 프로젝트 구조
- `app.py`: 홈(개요) + 공통 로딩/필터 UI의 진입점
- `pages/`
  - `01_개요(Home).py`
  - `02_노선별(Line).py`
  - `03_역상세(Station).py`
  - `04_비교(Compare).py`
  - `05_히트맵(Heatmap).py`
  - `06_데이터점검(DataQA).py`(옵션/권장)
- `src/`(선택)
  - `src/data.py`: load/clean/melt
  - `src/ui.py`: 공통 필터(사이드바) 컴포넌트
  - `src/charts.py`: 차트 생성 함수

### 5) 공통 UI(사이드바 필터) 설계
- **필터 항목**
  - 호선 선택(단일/복수)
  - 역 검색/선택(호선 선택에 연동)
  - 구분(direction) 선택(멀티)
  - 시간대 범위 선택(슬라이더 또는 멀티셀렉트)
  - 혼잡도 범위(슬라이더)
- **상태 유지**
  - `st.session_state`로 선택값 유지

### 6) 페이지별 구현 계획

### Page 1) 개요(Home)
- **목표**: 전체 혼잡도를 한눈에 요약
- **핵심 구성**
  - KPI: 전체 평균/최대 혼잡도, 전체 피크 시간대, 혼잡 TOP 역/구분
  - 시간대별 전체 평균 라인 차트(하루 패턴)
  - 시간대 선택(드롭다운) → 해당 시간대 역 TOP N 바 차트
- **필요 집계**
  - 시간대별 평균(전체)
  - 역×구분별 최대/평균, 피크 시간

### Page 2) 노선별(Line)
- **목표**: 노선 단위 비교/분석
- **핵심 구성**
  - 노선 선택 → 시간대별 평균 라인 차트(구분별 라인 분리 가능)
  - 해당 노선 역들의 피크 혼잡도 순위(표/막대)
  - 특정 시간대 선택 → 노선 내 역별 혼잡도 비교(막대)
- **필요 집계**
  - 노선×시간대 평균
  - 노선 내 역별 피크/평균

### Page 3) 역상세(Station)
- **목표**: 특정 역의 시간대 패턴을 깊게 보기
- **핵심 구성**
  - 역 선택(검색) + 구분 토글
  - 시간대별 혼잡도 라인 차트 + 피크 구간 강조
  - 요약 카드: 평균/최대/피크 시간, 혼잡 상위 시간대 TOP3
  - 필터 적용 결과 테이블 + 다운로드(CSV)

### Page 4) 비교(Compare)
- **목표**: 여러 역(또는 역+구분)을 한 화면에서 비교
- **핵심 구성**
  - 비교 대상(역 2~5개) 멀티 선택
  - 시간대별 라인 차트(역별 라인)
  - 선택 시간대에서 막대 비교
  - 피크 값/피크 시간 비교 테이블
- **성능 주의**
  - 선택된 대상만 필터링 후 차트 렌더링

### Page 5) 시간대 히트맵(Heatmap)
- **목표**: 언제/어디가 혼잡한지 직관적으로
- **핵심 구성**
  - 노선 선택 → (역 × 시간대) 히트맵
  - 정렬 옵션: 역명순 / 피크순 / 특정 시간대 값순
  - 구분별 탭 또는 토글
- **필요 변환**
  - long → pivot(`index=station`, `columns=time_slot`, `values=congestion`)

### Page 6) 데이터 점검(DataQA) (권장)
- **목표**: 데이터 품질/해석 가능성 확보
- **핵심 구성**
  - 결측/0 값 비율, 이상치(예: 200% 이상) 탐지
  - 행/열 수, 고유 역 수, 호선 목록
  - 필터된 데이터 다운로드
- **추가 메모**
  - 혼잡도(%)의 의미(기준) 설명 문구를 화면에 명시 권장

### 7) 차트 라이브러리 권장
- **Plotly**: 인터랙션(줌/툴팁/범례)이 쉬워 대시보드에 적합
- **Altair**: 선언적 문법, 데이터가 크지 않을 때 깔끔
- (둘 중 하나로 통일 권장)

### 8) 구현 순서(MVP → 확장)
- **MVP(최소 기능)**
  - 로딩/전처리/캐시 + 공통 필터
  - 개요(Home), 노선별(Line), 역상세(Station)
- **확장**
  - 비교(Compare), 히트맵(Heatmap), 데이터점검(DataQA)

### 9) 체크리스트(완료 기준)
- 한글이 정상적으로 보인다(인코딩 처리)
- 필터가 모든 페이지에 일관되게 적용된다
- 시간대 정렬이 올바르다(05:30 → 00:30)
- 다운로드 파일이 사용자 선택(필터)을 반영한다
- 큰 지연 없이 페이지가 전환된다(캐시/필터링 최소화)
